version: '2'
services:
    transmart_prod_servers:
        container_name: transmart_prod_servers
        build:
            context: ../servers
            args:
                - http_proxy=${http_proxy_IN_CONTAINER}
                - HTTP_PROXY=${HTTP_PROXY_IN_CONTAINER}
                - https_proxy=${https_proxy_IN_CONTAINER}
                - HTTPS_PROXY=${HTTPS_PROXY_IN_CONTAINER}
        volumes:
            - /var/local/transmart/prod/.grails:/root/.grails
            - /transmart_prod:/transmart_prod # Used for sharing R data
            - /transmart_prod/transmart-webapps-prod:/usr/local/tomcat/webapps # Used for sharing R scripts
            - /var/local/transmart/prod/data/solr:/usr/local/transmart/transmart-data-sanofi-release-16.1/solr/solr
            - /var/local/transmart/prod/etc/solr-auth:/usr/local/transmart/transmart-data-sanofi-release-16.1/solr/etc/auth
            - /var/local/transmart/prod/workspace:/workspace
            - /var/local/transmart/.m2/repository:/root/.m2/repository
            - /var/local/transmart/etc:/usr/local/etc
            - /etc:/etc.host:ro
        environment:
            - http_proxy=${http_proxy_IN_CONTAINER}
            - HTTP_PROXY=${HTTP_PROXY_IN_CONTAINER}
            - https_proxy=${https_proxy_IN_CONTAINER}
            - HTTPS_PROXY=${HTTPS_PROXY_IN_CONTAINER}
            - HOST_HOSTNAME=${HOSTNAME}
    transmart_prod_front:
        container_name: transmart_prod_front
        build:
            context: ../front
            args:
                - http_proxy=${http_proxy_IN_CONTAINER}
        ports:
            - "80:80"
            - "443:443"
        links:
            - transmart_prod_servers:transmart_app
        volumes:
            - /var/local/transmart/prod/etc/front-certs:/usr/local/apache2/conf/certs
            - /var/local/transmart/prod/etc/solr-auth:/usr/local/apache2/conf/solr-auth
        environment:
            - HOST_HOSTNAME=${HOSTNAME}